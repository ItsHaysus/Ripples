<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Colorful Water Ripples</title>
    <meta name="description" content="Draw with your finger to create colorful water-like ripples." />
    <meta name="theme-color" content="#0b1020" />
    <link rel="manifest" href="manifest.json" />
    <style>
      html, body { margin: 0; height: 100%; background: #0b1020; touch-action: none; }
      canvas { display: block; width: 100%; height: 100%; }
    </style>
  </head>
  <body>
    <canvas id="canvas"></canvas>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./service-worker.js')
            .then(() => console.log('Service Worker registered.'))
            .catch(err => console.error('Service Worker registration failed:', err));
        });
      }

      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d', { alpha: false });
      let width, height, dpr;

      function resize() {
        dpr = window.devicePixelRatio || 1;
        width = window.innerWidth;
        height = window.innerHeight;
        canvas.width = width * dpr;
        canvas.height = height * dpr;
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      }
      window.addEventListener('resize', resize);
      resize();

      const drops = [];
      canvas.addEventListener('pointerdown', e => addDrop(e.offsetX, e.offsetY));
      canvas.addEventListener('pointermove', e => {
        if (e.buttons) addDrop(e.offsetX, e.offsetY);
      });

      function addDrop(x, y) {
        drops.push({ x, y, t: performance.now(), hue: Math.random() * 360 });
      }

      function draw(t) {
        ctx.fillStyle = 'rgba(11,16,32,0.15)';
        ctx.fillRect(0, 0, width, height);
        for (let i = drops.length - 1; i >= 0; i--) {
          const d = drops[i];
          const age = (t - d.t) / 1000;
          const r = age * 240;
          if (r > 900) {
            drops.splice(i, 1);
            continue;
          }
          ctx.beginPath();
          ctx.arc(d.x, d.y, r, 0, Math.PI * 2);
          ctx.strokeStyle = `hsla(${(d.hue + age * 60) % 360}, 95%, 65%, ${Math.max(0, 0.5 - age * 0.25)})`;
          ctx.lineWidth = Math.max(0.5, 3 - age * 2);
          ctx.stroke();
        }
        requestAnimationFrame(draw);
      }
      requestAnimationFrame(draw);
    </script>
  </body>
</html>
