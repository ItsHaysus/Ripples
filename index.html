<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Colorful Water Trail</title>
    <meta name="description" content="Draw colorful trails with your finger like a paintbrush." />
    <meta name="theme-color" content="#0b1020" />
    <link rel="manifest" href="manifest.json" />
    <style>
      html, body {
        margin: 0; 
        height: 100%; 
        background: #0b1020; 
        touch-action: none;
        display: flex;
        flex-direction: column;
        user-select: none;
        -webkit-user-select: none;
      }
      #controls {
        background: #121722;
        padding: 10px;
        display: flex;
        gap: 10px;
        align-items: center;
        color: white;
        font-family: sans-serif;
      }
      canvas {
        flex: 1;
        display: block;
        width: 100%;
        height: 100%;
        cursor: crosshair;
      }
      select, button {
        background: #1e2735;
        border: none;
        color: white;
        padding: 6px 10px;
        font-size: 1rem;
        border-radius: 4px;
        cursor: pointer;
      }
      select:focus, button:focus {
        outline: 2px solid #4f9eff;
      }
    </style>
  </head>
  <body>
    <div id="controls">
      <label for="colorMode">Brush Color:</label>
      <select id="colorMode">
        <option value="rainbow" selected>Rainbow</option>
        <option value="red">Red</option>
        <option value="black">Black</option>
        <option value="blue">Blue</option>
      </select>
      <button id="resetBtn">Reset</button>
    </div>
    <canvas id="canvas"></canvas>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./service-worker.js')
            .then(() => console.log('Service Worker registered.'))
            .catch(err => console.error('Service Worker registration failed:', err));
        });
      }

      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d', { alpha: false });
      let width, height, dpr;

      function resize() {
        dpr = window.devicePixelRatio || 1;
        width = window.innerWidth;
        height = window.innerHeight - controls.offsetHeight;
        canvas.width = width * dpr;
        canvas.height = height * dpr;
        canvas.style.height = height + 'px';
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
      }

      const controls = document.getElementById('controls');
      window.addEventListener('resize', resize);
      resize();

      let drawing = false;
      let lastX = 0;
      let lastY = 0;
      let hue = 0;
      let colorMode = 'rainbow';

      const colorSelect = document.getElementById('colorMode');
      const resetBtn = document.getElementById('resetBtn');

      colorSelect.addEventListener('change', (e) => {
        colorMode = e.target.value;
        if (colorMode === 'rainbow') {
          hue = Math.random() * 360;
        }
      });

      resetBtn.addEventListener('click', () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      });

      function getBrushColor() {
        switch(colorMode) {
          case 'red': return 'hsl(0, 100%, 65%)';
          case 'black': return 'hsl(0, 0%, 10%)';
          case 'blue': return 'hsl(210, 100%, 65%)';
          case 'rainbow':
          default:
            return `hsl(${hue}, 100%, 65%)`;
        }
      }

      function pointerDown(e) {
        drawing = true;
        lastX = e.offsetX;
        lastY = e.offsetY;
        if (colorMode === 'rainbow') {
          hue = Math.random() * 360;
        }
      }

      function pointerMove(e) {
        if (!drawing) return;
        const x = e.offsetX;
        const y = e.offsetY;

        ctx.strokeStyle = getBrushColor();
        ctx.lineWidth = 15;
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();

        lastX = x;
        lastY = y;

        if (colorMode === 'rainbow') {
          hue += 2;
          if (hue >= 360) hue -= 360;
        }
      }

      function pointerUp() {
        drawing = false;
      }

      canvas.addEventListener('pointerdown', pointerDown);
      canvas.addEventListener('pointermove', pointerMove);
      window.addEventListener('pointerup', pointerUp);
      window.addEventListener('pointercancel', pointerUp);
    </script>
  </body>
</html>
